"""Check if a host is in the Google Chrome HSTS Preload list"""

import functools
import os
import typing

__version__ = "2024.4.1"
__checksum__ = "72b90e80a4535c3e5e1a6fa4ceb87d3dd15ff87512355d3cd0809043f66a2eef"
__all__ = ["in_hsts_preload"]

# fmt: off
_GTLD_INCLUDE_SUBDOMAINS = {b'amazon', b'android', b'app', b'audible', b'azure', b'bank', b'bing', b'boo', b'channel', b'chrome', b'dad', b'day', b'dev', b'eat', b'esq', b'fire', b'fly', b'foo', b'gle', b'gmail', b'google', b'hangout', b'hotmail', b'imdb', b'ing', b'insurance', b'kindle', b'meet', b'meme', b'microsoft', b'mov', b'new', b'nexus', b'office', b'page', b'phd', b'play', b'prime', b'prof', b'rsvp', b'search', b'silk', b'skype', b'windows', b'xbox', b'xn--cckwcxetd', b'xn--jlq480n2rg', b'youtube', b'zappos', b'zip'}  # noqa: E501
_JUMPTABLE = [[(0, 11), (11, 5), (16, 19), (35, 55), (90, 26), (116, 12), None, (128, 19), (147, 22), (169, 7), (176, 13), (189, 18), None, (207, 29), (236, 37), (273, 19), (292, 9), (301, 36), (337, 24), (361, 10), (371, 18), None, (389, 62), (451, 8), (459, 22), (481, 19), (500, 13), (513, 14), (527, 14), None, None, (541, 40), (581, 20), (601, 25), (626, 22), (648, 22), (670, 28), None, (698, 15), (713, 25), (738, 8), (746, 13), (759, 10), None, (769, 17), (786, 6), (792, 19), (811, 16), (827, 5), (832, 19), (851, 14), (865, 11), (876, 18), (894, 27), (921, 7), (928, 11), (939, 15), (954, 12), (966, 20), (986, 8), (994, 27), (1021, 46), (1067, 25), (1092, 16), (1108, 8), (1116, 5), (1121, 22), (1143, 18), None, (1161, 36), (1197, 15), (1212, 24), (1236, 11), None, (1247, 10), (1257, 23), (1280, 18), (1298, 18), None, (1316, 20), (1336, 26), (1362, 27), (1389, 28), (1417, 20), (1437, 59), (1496, 14), (1510, 14), (1524, 8), (1532, 8), (1540, 10), (1550, 13), (1563, 20), (1583, 19), None, (1602, 13), (1615, 26), (1641, 11), (1652, 4), (1656, 22), (1678, 19), (1697, 15), (1712, 14), (1726, 28), (1754, 11), (1765, 10), (1775, 12), (1787, 25), None, (1812, 19), (1831, 14), (1845, 26), (1871, 45), (1916, 15), None, (1931, 11), (1942, 30), (1972, 21), (1993, 26), (2019, 6), (2025, 6), (2031, 14), (2045, 5), (2050, 30), (2080, 23), (2103, 6), (2109, 17), (2126, 8), (2134, 12), (2146, 12), (2158, 70), (2228, 55), (2283, 12), (2295, 23), (2318, 16), (2334, 41), (2375, 9), (2384, 24), (2408, 44), (2452, 6), (2458, 41), (2499, 22), (2521, 23), (2544, 31), (2575, 20), (2595, 8), (2603, 15), (2618, 12), (2630, 32), (2662, 25), (2687, 15), None, (2702, 46), (2748, 21), (2769, 17), (2786, 18), (2804, 26), (2830, 5), (2835, 37), (2872, 39), (2911, 16), (2927, 33), (2960, 17), (2977, 23), (3000, 21), (3021, 25), (3046, 8), (3054, 14), (3068, 7), (3075, 37), None, (3112, 18), (3130, 21), (3151, 20), (3171, 17), (3188, 24), (3212, 12), (3224, 36), (3260, 35), (3295, 12), (3307, 57), (3364, 25), (3389, 32), None, (3421, 8), (3429, 25), (3454, 18), (3472, 6), (3478, 23), None, (3501, 36), (3537, 33), (3570, 14), (3584, 16), (3600, 22), None, (3622, 30), (3652, 41), (3693, 50), (3743, 15), (3758, 20), (3778, 31), (3809, 21), (3830, 32), (3862, 24), (3886, 20), (3906, 17), (3923, 52), (3975, 6), (3981, 9), (3990, 12), (4002, 18), (4020, 11), (4031, 10), (4041, 39), (4080, 42), None, (4122, 36), (4158, 17), None, (4175, 8), (4183, 8), (4191, 7), None, (4198, 25), (4223, 17), None, (4240, 21), (4261, 35), (4296, 21), (4317, 10), (4327, 48), (4375, 11), (4386, 37), (4423, 25), (4448, 19), (4467, 12), (4479, 14), (4493, 23), (4516, 29), (4545, 14), (4559, 8), (4567, 47), (4614, 52), None, None, (4666, 47), (4713, 46), None, (4759, 18), None, (4777, 15), (4792, 8), (4800, 21), (4821, 6), (4827, 29), (4856, 22)], [(4878, 8122), (13000, 8000), (21000, 8393), (29393, 8285), (37678, 7874), (45552, 8063), (53615, 8457), (62072, 7748), (69820, 7901), (77721, 7691), (85412, 8321), (93733, 7369), (101102, 8095), (109197, 9012), (118209, 8072), (126281, 8832), (135113, 8995), (144108, 7369), (151477, 8482), (159959, 7451), (167410, 8308), (175718, 7983), (183701, 8145), (191846, 8576), (200422, 8231), (208653, 7862), (216515, 8662), (225177, 9299), (234476, 7790), (242266, 7853), (250119, 8557), (258676, 8280), (266956, 8105), (275061, 8430), (283491, 8039), (291530, 8536), (300066, 8426), (308492, 8969), (317461, 8567), (326028, 8479), (334507, 8470), (342977, 7536), (350513, 7967), (358480, 7989), (366469, 7721), (374190, 8362), (382552, 7780), (390332, 9168), (399500, 8093), (407593, 7600), (415193, 8035), (423228, 7657), (430885, 8245), (439130, 8209), (447339, 7900), (455239, 8183), (463422, 8194), (471616, 8404), (480020, 8140), (488160, 6845), (495005, 7503), (502508, 8429), (510937, 8169), (519106, 8601), (527707, 8972), (536679, 7741), (544420, 8194), (552614, 8557), (561171, 9001), (570172, 7854), (578026, 7616), (585642, 7647), (593289, 7288), (600577, 8893), (609470, 7827), (617297, 8368), (625665, 7761), (633426, 8987), (642413, 8128), (650541, 8063), (658604, 8135), (666739, 7421), (674160, 7919), (682079, 8305), (690384, 8297), (698681, 8166), (706847, 8712), (715559, 8007), (723566, 7530), (731096, 7990), (739086, 9344), (748430, 8158), (756588, 7820), (764408, 8191), (772599, 8038), (780637, 8002), (788639, 8143), (796782, 7430), (804212, 8397), (812609, 7576), (820185, 8094), (828279, 7858), (836137, 7981), (844118, 7809), (851927, 7917), (859844, 8605), (868449, 8275), (876724, 8392), (885116, 7893), (893009, 7839), (900848, 8738), (909586, 8151), (917737, 7399), (925136, 7620), (932756, 8138), (940894, 8040), (948934, 8179), (957113, 8550), (965663, 8006), (973669, 8139), (981808, 8100), (989908, 8184), (998092, 7663), (1005755, 8193), (1013948, 8589), (1022537, 7751), (1030288, 7917), (1038205, 8869), (1047074, 7992), (1055066, 9226), (1064292, 8901), (1073193, 7898), (1081091, 7737), (1088828, 7475), (1096303, 7859), (1104162, 8805), (1112967, 8797), (1121764, 9276), (1131040, 8422), (1139462, 8494), (1147956, 9108), (1157064, 8574), (1165638, 7958), (1173596, 8135), (1181731, 8885), (1190616, 7238), (1197854, 8240), (1206094, 7876), (1213970, 8090), (1222060, 8235), (1230295, 8152), (1238447, 8227), (1246674, 8212), (1254886, 7518), (1262404, 7902), (1270306, 8381), (1278687, 8289), (1286976, 8232), (1295208, 7778), (1302986, 7466), (1310452, 7744), (1318196, 8191), (1326387, 8214), (1334601, 7789), (1342390, 8364), (1350754, 8817), (1359571, 8600), (1368171, 7627), (1375798, 9339), (1385137, 8111), (1393248, 7922), (1401170, 8134), (1409304, 8809), (1418113, 7567), (1425680, 7712), (1433392, 8259), (1441651, 8593), (1450244, 8466), (1458710, 7693), (1466403, 7600), (1474003, 9983), (1483986, 8643), (1492629, 7717), (1500346, 8058), (1508404, 8454), (1516858, 8336), (1525194, 7504), (1532698, 8749), (1541447, 8078), (1549525, 8248), (1557773, 8142), (1565915, 7634), (1573549, 7943), (1581492, 7367), (1588859, 8195), (1597054, 7360), (1604414, 7362), (1611776, 7564), (1619340, 7894), (1627234, 8384), (1635618, 8118), (1643736, 8237), (1651973, 8502), (1660475, 7452), (1667927, 8388), (1676315, 8753), (1685068, 7608), (1692676, 8379), (1701055, 9033), (1710088, 7647), (1717735, 8959), (1726694, 8247), (1734941, 7848), (1742789, 8197), (1750986, 8453), (1759439, 8277), (1767716, 7997), (1775713, 8311), (1784024, 7876), (1791900, 8792), (1800692, 8021), (1808713, 7546), (1816259, 8688), (1824947, 8126), (1833073, 8415), (1841488, 7907), (1849395, 8803), (1858198, 8483), (1866681, 8432), (1875113, 8899), (1884012, 8688), (1892700, 8176), (1900876, 8013), (1908889, 8366), (1917255, 7994), (1925249, 9097), (1934346, 8150), (1942496, 7593), (1950089, 7692), (1957781, 8534), (1966315, 8692), (1975007, 8392), (1983399, 8465), (1991864, 8240), (2000104, 7820), (2007924, 8840), (2016764, 8281), (2025045, 8096), (2033141, 8177), (2041318, 7318), (2048636, 8120), (2056756, 8249), (2065005, 7922), (2072927, 7910), (2080837, 8027), (2088864, 8470)], [(2097334, 864), (2098198, 728), (2098926, 844), (2099770, 759), (2100529, 870), (2101399, 769), (2102168, 623), (2102791, 891), (2103682, 640), (2104322, 854), (2105176, 470), (2105646, 624), (2106270, 829), (2107099, 971), (2108070, 820), (2108890, 614), (2109504, 1240), (2110744, 620), (2111364, 698), (2112062, 814), (2112876, 1051), (2113927, 729), (2114656, 725), (2115381, 622), (2116003, 709), (2116712, 655), (2117367, 839), (2118206, 1331), (2119537, 715), (2120252, 748), (2121000, 772), (2121772, 689), (2122461, 675), (2123136, 731), (2123867, 990), (2124857, 882), (2125739, 505), (2126244, 756), (2127000, 704), (2127704, 845), (2128549, 794), (2129343, 713), (2130056, 675), (2130731, 801), (2131532, 687), (2132219, 698), (2132917, 649), (2133566, 727), (2134293, 684), (2134977, 493), (2135470, 706), (2136176, 709), (2136885, 775), (2137660, 831), (2138491, 1214), (2139705, 608), (2140313, 729), (2141042, 699), (2141741, 570), (2142311, 617), (2142928, 791), (2143719, 878), (2144597, 949), (2145546, 833), (2146379, 673), (2147052, 694), (2147746, 921), (2148667, 629), (2149296, 558), (2149854, 1003), (2150857, 674), (2151531, 710), (2152241, 396), (2152637, 720), (2153357, 408), (2153765, 676), (2154441, 570), (2155011, 934), (2155945, 859), (2156804, 555), (2157359, 785), (2158144, 743), (2158887, 897), (2159784, 705), (2160489, 787), (2161276, 780), (2162056, 708), (2162764, 572), (2163336, 868), (2164204, 879), (2165083, 1130), (2166213, 1056), (2167269, 896), (2168165, 682), (2168847, 675), (2169522, 487), (2170009, 942), (2170951, 727), (2171678, 762), (2172440, 614), (2173054, 739), (2173793, 730), (2174523, 759), (2175282, 534), (2175816, 780), (2176596, 903), (2177499, 662), (2178161, 571), (2178732, 812), (2179544, 883), (2180427, 743), (2181170, 980), (2182150, 1016), (2183166, 629), (2183795, 659), (2184454, 699), (2185153, 706), (2185859, 841), (2186700, 662), (2187362, 702), (2188064, 1073), (2189137, 732), (2189869, 847), (2190716, 753), (2191469, 774), (2192243, 686), (2192929, 809), (2193738, 784), (2194522, 575), (2195097, 921), (2196018, 639), (2196657, 862), (2197519, 597), (2198116, 649), (2198765, 587), (2199352, 860), (2200212, 702), (2200914, 682), (2201596, 628), (2202224, 799), (2203023, 774), (2203797, 699), (2204496, 624), (2205120, 550), (2205670, 750), (2206420, 479), (2206899, 781), (2207680, 637), (2208317, 831), (2209148, 616), (2209764, 758), (2210522, 571), (2211093, 784), (2211877, 876), (2212753, 994), (2213747, 793), (2214540, 800), (2215340, 966), (2216306, 871), (2217177, 682), (2217859, 911), (2218770, 657), (2219427, 813), (2220240, 870), (2221110, 1023), (2222133, 1009), (2223142, 551), (2223693, 927), (2224620, 684), (2225304, 613), (2225917, 704), (2226621, 517), (2227138, 1071), (2228209, 567), (2228776, 963), (2229739, 775), (2230514, 874), (2231388, 635), (2232023, 611), (2232634, 712), (2233346, 1903), (2235249, 722), (2235971, 708), (2236679, 817), (2237496, 982), (2238478, 639), (2239117, 756), (2239873, 835), (2240708, 573), (2241281, 903), (2242184, 667), (2242851, 599), (2243450, 559), (2244009, 1115), (2245124, 715), (2245839, 692), (2246531, 579), (2247110, 651), (2247761, 932), (2248693, 603), (2249296, 787), (2250083, 714), (2250797, 833), (2251630, 684), (2252314, 679), (2252993, 593), (2253586, 696), (2254282, 947), (2255229, 852), (2256081, 662), (2256743, 757), (2257500, 650), (2258150, 818), (2258968, 1129), (2260097, 517), (2260614, 789), (2261403, 713), (2262116, 770), (2262886, 660), (2263546, 579), (2264125, 653), (2264778, 795), (2265573, 725), (2266298, 1041), (2267339, 550), (2267889, 648), (2268537, 735), (2269272, 708), (2269980, 727), (2270707, 742), (2271449, 814), (2272263, 488), (2272751, 946), (2273697, 577), (2274274, 685), (2274959, 708), (2275667, 854), (2276521, 587), (2277108, 868), (2277976, 853), (2278829, 803), (2279632, 491), (2280123, 805), (2280928, 464), (2281392, 825), (2282217, 526), (2282743, 700), (2283443, 824), (2284267, 619), (2284886, 886), (2285772, 2298), (2288070, 607), (2288677, 822), (2289499, 774), (2290273, 829), (2291102, 685)], [(2291787, 48), None, None, (2291835, 42), None, (2291877, 27), (2291904, 18), None, None, None, None, None, None, None, (2291922, 21), None, None, (2291943, 42), None, (2291985, 25), (2292010, 44), None, (2292054, 49), None, None, None, None, None, None, None, None, None, (2292103, 21), (2292124, 46), None, None, (2292170, 44), None, None, None, None, (2292214, 44), (2292258, 21), (2292279, 23), None, None, None, None, (2292302, 42), None, None, None, None, None, (2292344, 31), None, None, None, None, (2292375, 42), (2292417, 19), None, None, (2292436, 21), None, (2292457, 26), (2292483, 56), None, (2292539, 16), (2292555, 42), (2292597, 27), None, None, None, None, (2292624, 21), (2292645, 52), None, (2292697, 17), (2292714, 20), (2292734, 42), None, None, None, (2292776, 25), (2292801, 17), (2292818, 27), (2292845, 21), None, None, None, (2292866, 24), None, (2292890, 24), (2292914, 21), (2292935, 24), None, (2292959, 48), None, None, (2293007, 17), (2293024, 19), None, None, None, None, (2293043, 31), None, None, None, None, None, None, (2293074, 28), None, (2293102, 64), (2293166, 42), (2293208, 17), (2293225, 17), (2293242, 26), None, (2293268, 19), None, None, None, None, (2293287, 20), None, None, (2293307, 42), (2293349, 63), (2293412, 17), None, None, (2293429, 21), None, None, None, None, (2293450, 21), (2293471, 16), None, (2293487, 31), None, None, None, None, (2293518, 42), None, (2293560, 80), None, (2293640, 9), None, (2293649, 21), (2293670, 42), None, (2293712, 18), (2293730, 90), (2293820, 56), (2293876, 45), None, (2293921, 42), None, None, (2293963, 24), (2293987, 21), None, None, None, None, None, (2294008, 42), (2294050, 21), (2294071, 21), None, (2294092, 42), (2294134, 25), None, (2294159, 40), (2294199, 21), (2294220, 56), None, None, (2294276, 36), (2294312, 16), None, None, (2294328, 16), None, (2294344, 35), None, None, (2294379, 21), None, (2294400, 22), (2294422, 21), (2294443, 21), (2294464, 21), None, (2294485, 63), (2294548, 41), (2294589, 21), (2294610, 42), None, None, None, None, None, (2294652, 15), (2294667, 21), (2294688, 21), None, None, (2294709, 21), None, None, (2294730, 21), None, None, (2294751, 19), (2294770, 66), None, None, None, (2294836, 50), None, (2294886, 21), (2294907, 21), (2294928, 19), None, None, (2294947, 26), None, (2294973, 58), (2295031, 42), None, None, None, None, None, None, (2295073, 21), None, None, None, (2295094, 21), None, None, (2295115, 64), None, (2295179, 254), (2295433, 21), (2295454, 24), None, (2295478, 21), (2295499, 14)], [None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, (2295513, 62), None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None]]  # noqa: E501
_CRC8_TABLE = [
    0x00, 0x07, 0x0e, 0x09, 0x1c, 0x1b, 0x12, 0x15,
    0x38, 0x3f, 0x36, 0x31, 0x24, 0x23, 0x2a, 0x2d,
    0x70, 0x77, 0x7e, 0x79, 0x6c, 0x6b, 0x62, 0x65,
    0x48, 0x4f, 0x46, 0x41, 0x54, 0x53, 0x5a, 0x5d,
    0xe0, 0xe7, 0xee, 0xe9, 0xfc, 0xfb, 0xf2, 0xf5,
    0xd8, 0xdf, 0xd6, 0xd1, 0xc4, 0xc3, 0xca, 0xcd,
    0x90, 0x97, 0x9e, 0x99, 0x8c, 0x8b, 0x82, 0x85,
    0xa8, 0xaf, 0xa6, 0xa1, 0xb4, 0xb3, 0xba, 0xbd,
    0xc7, 0xc0, 0xc9, 0xce, 0xdb, 0xdc, 0xd5, 0xd2,
    0xff, 0xf8, 0xf1, 0xf6, 0xe3, 0xe4, 0xed, 0xea,
    0xb7, 0xb0, 0xb9, 0xbe, 0xab, 0xac, 0xa5, 0xa2,
    0x8f, 0x88, 0x81, 0x86, 0x93, 0x94, 0x9d, 0x9a,
    0x27, 0x20, 0x29, 0x2e, 0x3b, 0x3c, 0x35, 0x32,
    0x1f, 0x18, 0x11, 0x16, 0x03, 0x04, 0x0d, 0x0a,
    0x57, 0x50, 0x59, 0x5e, 0x4b, 0x4c, 0x45, 0x42,
    0x6f, 0x68, 0x61, 0x66, 0x73, 0x74, 0x7d, 0x7a,
    0x89, 0x8e, 0x87, 0x80, 0x95, 0x92, 0x9b, 0x9c,
    0xb1, 0xb6, 0xbf, 0xb8, 0xad, 0xaa, 0xa3, 0xa4,
    0xf9, 0xfe, 0xf7, 0xf0, 0xe5, 0xe2, 0xeb, 0xec,
    0xc1, 0xc6, 0xcf, 0xc8, 0xdd, 0xda, 0xd3, 0xd4,
    0x69, 0x6e, 0x67, 0x60, 0x75, 0x72, 0x7b, 0x7c,
    0x51, 0x56, 0x5f, 0x58, 0x4d, 0x4a, 0x43, 0x44,
    0x19, 0x1e, 0x17, 0x10, 0x05, 0x02, 0x0b, 0x0c,
    0x21, 0x26, 0x2f, 0x28, 0x3d, 0x3a, 0x33, 0x34,
    0x4e, 0x49, 0x40, 0x47, 0x52, 0x55, 0x5c, 0x5b,
    0x76, 0x71, 0x78, 0x7f, 0x6a, 0x6d, 0x64, 0x63,
    0x3e, 0x39, 0x30, 0x37, 0x22, 0x25, 0x2c, 0x2b,
    0x06, 0x01, 0x08, 0x0f, 0x1a, 0x1d, 0x14, 0x13,
    0xae, 0xa9, 0xa0, 0xa7, 0xb2, 0xb5, 0xbc, 0xbb,
    0x96, 0x91, 0x98, 0x9f, 0x8a, 0x8d, 0x84, 0x83,
    0xde, 0xd9, 0xd0, 0xd7, 0xc2, 0xc5, 0xcc, 0xcb,
    0xe6, 0xe1, 0xe8, 0xef, 0xfa, 0xfd, 0xf4, 0xf3
]
# fmt: on

_IS_LEAF = 0x80
_INCLUDE_SUBDOMAINS = 0x40


try:
    from importlib.resources import open_binary

    def open_pkg_binary(path: str) -> typing.BinaryIO:
        return open_binary("hstspreload", path)


except ImportError:

    def open_pkg_binary(path: str) -> typing.BinaryIO:
        return open(
            os.path.join(os.path.dirname(os.path.abspath(__file__)), path),
            "rb",
        )


@functools.lru_cache(maxsize=1024)
def in_hsts_preload(host: typing.AnyStr) -> bool:
    """Determines if an IDNA-encoded host is on the HSTS preload list"""

    if isinstance(host, str):
        host = host.encode("ascii")
    labels = host.lower().split(b".")

    # Fast-branch for gTLDs that are registered to preload all sub-domains.
    if labels[-1] in _GTLD_INCLUDE_SUBDOMAINS:
        return True

    with open_pkg_binary("hstspreload.bin") as f:
        for layer, label in enumerate(labels[::-1]):
            # None of our layers are greater than 5 deep.
            if layer > 4:
                return False

            # Read the jump table for the layer and label
            jump_info = _JUMPTABLE[layer][_crc8(label)]
            if jump_info is None:
                # No entry: host is not preloaded
                return False

            # Read the set of entries for that layer and label
            f.seek(jump_info[0])
            data = bytearray(jump_info[1])
            f.readinto(data)

            for is_leaf, include_subdomains, ent_label in _iter_entries(data):
                # We found a potential leaf
                if is_leaf:
                    if ent_label == host:
                        return True
                    if include_subdomains and host.endswith(b"." + ent_label):
                        return True

                # Continue traversing as we're not at a leaf.
                elif label == ent_label:
                    break
            else:
                return False
    return False


def _iter_entries(data: bytes) -> typing.Iterable[typing.Tuple[int, int, bytes]]:
    while data:
        flags = data[0]
        size = data[1]
        label = bytes(data[2 : 2 + size])
        yield (flags & _IS_LEAF, flags & _INCLUDE_SUBDOMAINS, label)
        data = data[2 + size :]


def _crc8(value: bytes) -> int:
    # CRC8 reference implementation: https://github.com/niccokunzmann/crc8
    checksum = 0x00
    for byte in value:
        checksum = _CRC8_TABLE[checksum ^ byte]
    return checksum
